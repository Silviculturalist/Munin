<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Munin.Helpers.Primitives &#8212; Munin  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Munin.Helpers.Primitives</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">CRS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Munin.Helpers.TreeSpecies</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TreeName</span><span class="p">,</span> 
    <span class="n">TreeSpecies</span><span class="p">,</span>
    <span class="n">parse_tree_species</span>
<span class="p">)</span>
<span class="c1"># --------------------------------------------------------------------------------</span>
<span class="c1"># Simple typed &quot;float-like&quot; classes that carry extra metadata, following your style</span>
<span class="c1"># --------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Diameter_cm">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Diameter_cm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Diameter_cm</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Diameter, in centimeters, stored as a float but including additional metadata:</span>
<span class="sd">      - over_bark (bool): whether the diameter is measured over bark.</span>
<span class="sd">      - measurement_height_m (float): height at which diameter is measured (default: 1.3 m).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">over_bark</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">measurement_height_m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Diameter must be non-negative.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">measurement_height_m</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;measurement_height_m must be &gt;= 0 m!&#39;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">over_bark</span> <span class="o">=</span> <span class="n">over_bark</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">measurement_height_m</span> <span class="o">=</span> <span class="n">measurement_height_m</span>
        <span class="k">return</span> <span class="n">obj</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Diameter_cm(</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">, over_bark=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">over_bark</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;measurement_height_m=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_height_m</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>



<span class="c1"># --- Age Enum ---</span>
<div class="viewcode-block" id="Age">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Age">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Age</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">TOTAL</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">DBH</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;AgeMeasurement&#39;</span><span class="p">:</span> <span class="c1"># Use forward reference string</span>
        <span class="k">return</span> <span class="n">AgeMeasurement</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<span class="c1"># --- AgeMeasurement Class ---</span>
<div class="viewcode-block" id="AgeMeasurement">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.AgeMeasurement">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AgeMeasurement</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Age must be non-negative.&quot;</span><span class="p">)</span>
        <span class="c1"># Ensure code is valid using the Age enum definition</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Age</span><span class="p">]:</span> <span class="c1"># Check against Age enum values</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid age code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">. Must be one of </span><span class="si">{</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Age</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Ensure Age enum lookup is safe</span>
        <span class="n">age_type</span> <span class="o">=</span> <span class="s1">&#39;UNKNOWN&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">age_type</span> <span class="o">=</span> <span class="n">Age</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># Keep &#39;UNKNOWN&#39; if code not in enum</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AgeMeasurement(</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">, code=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">age_type</span><span class="si">}</span><span class="s2">])&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">AgeMeasurement</span><span class="p">):</span>
             <span class="c1"># *** Crucial: Compare both value and code ***</span>
             <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">code</span>
         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
             <span class="c1"># Comparison with plain number only checks value</span>
             <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
         <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span> <span class="k">if</span> <span class="n">equal</span> <span class="ow">is</span> <span class="bp">NotImplemented</span> <span class="k">else</span> <span class="ow">not</span> <span class="n">equal</span></div>




<div class="viewcode-block" id="StandBasalArea">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.StandBasalArea">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StandBasalArea</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents basal area (m²/ha) for one or more species.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    species : TreeName | list[TreeName]</span>
<span class="sd">        The species (or list of species) to which this basal area applies.</span>
<span class="sd">    precision : float</span>
<span class="sd">        Standard deviation, standard error, or other measure of precision (if known).</span>
<span class="sd">    over_bark : bool</span>
<span class="sd">        True if the basal area is measured over bark.</span>
<span class="sd">    direct_estimate : bool</span>
<span class="sd">        True if this is a direct field estimate (e.g. from Bitterlich sampling).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TreeName</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="n">over_bark</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">direct_estimate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;StandBasalArea must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">float</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">over_bark</span> <span class="o">=</span> <span class="n">over_bark</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">direct_estimate</span> <span class="o">=</span> <span class="n">direct_estimate</span>
        <span class="k">return</span> <span class="n">obj</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;StandBasalArea(</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m^2/ha, species=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;precision=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="si">}</span><span class="s2">, over_bark=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">over_bark</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;direct_estimate=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_estimate</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="StandVolume">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.StandVolume">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StandVolume</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a volume (m³/ha, typically) of standing trees in a stand,</span>
<span class="sd">    optionally for a single species or multiple species.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    species : TreeName | list[TreeName]</span>
<span class="sd">        The species or list of species for which the volume is estimated.</span>
<span class="sd">    precision : float</span>
<span class="sd">        Standard deviation or other measure of precision (if known).</span>
<span class="sd">    over_bark : bool</span>
<span class="sd">        True if the volume is measured over bark.</span>
<span class="sd">    fn : callable | None</span>
<span class="sd">        An optional reference to the function or model used to derive the volume.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TreeName</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="n">over_bark</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;StandVolume must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">float</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">over_bark</span> <span class="o">=</span> <span class="n">over_bark</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="k">return</span> <span class="n">obj</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;StandVolume(</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m^3/ha, species=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;precision=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="si">}</span><span class="s2">, over_bark=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">over_bark</span><span class="si">}</span><span class="s2">, fn=</span><span class="si">{</span><span class="n">f_str</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Stems">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Stems">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Stems</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the number of stems per hectare (stems/ha) for one or more species.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    species : TreeName | list[TreeName]</span>
<span class="sd">        The species (or list of species) to which this stems count applies.</span>
<span class="sd">    precision : float</span>
<span class="sd">        Standard deviation or similar measure of precision (if known).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TreeName</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Stems must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">float</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stems(</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> stems/ha, species=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;precision=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="TopHeightDefinition">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.TopHeightDefinition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TopHeightDefinition</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines how the &#39;top height&#39; (dominant height) is conceptually measured in a stand:</span>
<span class="sd">    - nominal_n: number of top trees in 1.0 hectare to average</span>
<span class="sd">    - nominal_area_ha: the area basis for that count</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nominal_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">nominal_area_ha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nominal_n</span> <span class="o">=</span> <span class="n">nominal_n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nominal_area_ha</span> <span class="o">=</span> <span class="n">nominal_area_ha</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;TopHeightDefinition(nominal_n=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nominal_n</span><span class="si">}</span><span class="s2">, area_ha=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nominal_area_ha</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<div class="viewcode-block" id="TopHeightMeasurement">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.TopHeightMeasurement">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TopHeightMeasurement</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A float-like class that stores the measured top (dominant) height of a stand.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    definition : TopHeightDefinition</span>
<span class="sd">        The definition used to identify the top height (e.g. top 100 trees per ha).</span>
<span class="sd">    species : TreeName | list[TreeName]</span>
<span class="sd">        The species or species mixture that this top height applies to.</span>
<span class="sd">    precision : float</span>
<span class="sd">        An estimate of precision (e.g. standard error) of the top height.</span>
<span class="sd">    est_bias : float</span>
<span class="sd">        Any known or estimated bias that might be subtracted (or added) from the measurement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">definition</span><span class="p">:</span> <span class="n">TopHeightDefinition</span><span class="p">,</span>
                <span class="n">species</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TreeName</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TreeName</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="n">est_bias</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TopHeightMeasurement cannot be negative.&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">float</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">est_bias</span> <span class="o">=</span> <span class="n">est_bias</span>
        <span class="k">return</span> <span class="n">obj</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TopHeightMeasurement(</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m, definition=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;species=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">, precision=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="si">}</span><span class="s2">, est_bias=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">est_bias</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuadraticMeanDiameter">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.QuadraticMeanDiameter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QuadraticMeanDiameter</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the quadratic mean diameter (in centimeters) with an associated precision.</span>
<span class="sd">    </span>
<span class="sd">    The value is computed as:</span>
<span class="sd">        QMD = sqrt((40000 * BasalArea) / (pi * Stems))</span>
<span class="sd">    where BasalArea is in m²/ha and Stems is in stems/ha.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;QuadraticMeanDiameter must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">float</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;QuadraticMeanDiameter(</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> cm, precision=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> cm)&quot;</span></div>



<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># Bitterlich (Angle count) Sampling</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="AngleCount">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.AngleCount">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AngleCount</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Holds parameters for angle-count (relascope) sampling,</span>
<span class="sd">    along with species-specific tally counts.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    ba_factor : float</span>
<span class="sd">        Basal Area Factor (m²/ha) per count.</span>
<span class="sd">    value : list[int]</span>
<span class="sd">        Parallel list of integer counts, each entry matching a species in &#39;species&#39;.</span>
<span class="sd">    species : list[TreeSpecies]</span>
<span class="sd">        Parallel list of species, each matching an entry in &#39;value&#39;.</span>
<span class="sd">    point_id : str | None</span>
<span class="sd">        Identifies the sampling point location (e.g., &#39;P1&#39;, &#39;P2&#39;, etc.).</span>
<span class="sd">    slope : float</span>
<span class="sd">        Slope correction factor or slope angle, if desired (default: 0.0).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">ba_factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TreeSpecies</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">point_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">slope</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ba_factor</span> <span class="o">=</span> <span class="n">ba_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span> <span class="k">if</span> <span class="n">species</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_id</span> <span class="o">=</span> <span class="n">point_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slope</span> <span class="o">=</span> <span class="n">slope</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Length mismatch: species has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="si">}</span><span class="s2"> entries &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;but value has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="AngleCount.add_observation">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.AngleCount.add_observation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="n">TreeSpecies</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add (or update) the tally count for the given species by `count`.</span>
<span class="sd">        Example:</span>
<span class="sd">            add_observation(TreeSpecies.Sweden.Picea_abies, 2)</span>
<span class="sd">            increments the Picea_abies count by 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">count</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="AngleCountAggregator">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.AngleCountAggregator">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AngleCountAggregator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregates multiple AngleCountRecord objects. </span>
<span class="sd">    Handles merging records with the same point_id and computes stand-level metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AngleCount</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">records</span>

<div class="viewcode-block" id="AngleCountAggregator.merge_by_point_id">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.AngleCountAggregator.merge_by_point_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">merge_by_point_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AngleCount</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge records that have the same point_id by averaging their counts.</span>
<span class="sd">        If point_id is None, they are treated as separate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">point_id</span> <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">point_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">id</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">merged</span><span class="p">:</span>
                <span class="n">merged</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_records</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">rec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">merged</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_merge_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec1</span><span class="p">:</span> <span class="n">AngleCount</span><span class="p">,</span> <span class="n">rec2</span><span class="p">:</span> <span class="n">AngleCount</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AngleCount</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge two records with the same point_id.</span>
<span class="sd">        This example assumes both records have the same species order and ba_factor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rec1</span><span class="o">.</span><span class="n">ba_factor</span> <span class="o">!=</span> <span class="n">rec2</span><span class="o">.</span><span class="n">ba_factor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot merge records with different ba_factor values.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rec1</span><span class="o">.</span><span class="n">species</span> <span class="o">!=</span> <span class="n">rec2</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot merge records with different species lists.&quot;</span><span class="p">)</span>

        <span class="c1"># Average the counts; you could also sum them depending on your intended semantics.</span>
        <span class="n">new_values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rec1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">rec2</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">AngleCount</span><span class="p">(</span>
            <span class="n">ba_factor</span><span class="o">=</span><span class="n">rec1</span><span class="o">.</span><span class="n">ba_factor</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">new_values</span><span class="p">,</span>
            <span class="n">species</span><span class="o">=</span><span class="n">rec1</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
            <span class="n">point_id</span><span class="o">=</span><span class="n">rec1</span><span class="o">.</span><span class="n">point_id</span><span class="p">,</span>
            <span class="n">slope</span><span class="o">=</span><span class="n">rec1</span><span class="o">.</span><span class="n">slope</span>  <span class="c1"># or combine slopes as needed</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="AngleCountAggregator.aggregate_stand_metrics">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.AngleCountAggregator.aggregate_stand_metrics">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate_stand_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">TreeName</span><span class="p">,</span> <span class="n">StandBasalArea</span><span class="p">],</span>
                                              <span class="n">Dict</span><span class="p">[</span><span class="n">TreeName</span><span class="p">,</span> <span class="n">Stems</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregate the merged records to compute stand-level metrics.</span>
<span class="sd">        Returns two dictionaries keyed by species (TreeName) with their</span>
<span class="sd">        corresponding StandBasalArea and Stems objects.</span>

<span class="sd">        For StandBasalArea, the value and precision are computed as:</span>
<span class="sd">          value = mean(counts) * ba_factor</span>
<span class="sd">          precision = sqrt(pvariance(counts)) * ba_factor</span>

<span class="sd">        For Stems, the value and precision are computed from the raw counts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">merged_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_by_point_id</span><span class="p">()</span>
        <span class="n">species_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TreeName</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">total_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Assume all records use the same ba_factor for simplicity.</span>
        <span class="n">ba_factor</span> <span class="o">=</span> <span class="n">merged_records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ba_factor</span> <span class="k">if</span> <span class="n">merged_records</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Collect counts per species and overall totals for each merged record.</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">merged_records</span><span class="p">:</span>
            <span class="n">record_total</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                <span class="n">record_total</span> <span class="o">+=</span> <span class="n">cnt</span>
                <span class="k">if</span> <span class="n">sp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">species_counts</span><span class="p">:</span>
                    <span class="n">species_counts</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">species_counts</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
            <span class="n">total_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_total</span><span class="p">)</span>

        <span class="n">basal_area_by_species</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TreeName</span><span class="p">,</span> <span class="n">StandBasalArea</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stems_by_species</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TreeName</span><span class="p">,</span> <span class="n">Stems</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Create metric objects for each species.</span>
        <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">counts</span> <span class="ow">in</span> <span class="n">species_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># For basal area: apply the ba_factor conversion.</span>
            <span class="n">count_mean</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
            <span class="n">count_var</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">pvariance</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">ba_value</span> <span class="o">=</span> <span class="n">count_mean</span> <span class="o">*</span> <span class="n">ba_factor</span>
            <span class="n">ba_precision</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">count_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">ba_factor</span>

            <span class="n">basal_area_by_species</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="n">StandBasalArea</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="n">ba_value</span><span class="p">,</span>
                <span class="n">species</span><span class="o">=</span><span class="n">sp</span><span class="p">,</span>
                <span class="n">precision</span><span class="o">=</span><span class="n">ba_precision</span><span class="p">,</span>
                <span class="n">over_bark</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">direct_estimate</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># For stems: use the raw counts.</span>
            <span class="n">stems_value</span> <span class="o">=</span> <span class="n">count_mean</span>
            <span class="n">stems_precision</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">count_var</span><span class="p">)</span>

            <span class="n">stems_by_species</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stems</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="n">stems_value</span><span class="p">,</span>
                <span class="n">species</span><span class="o">=</span><span class="n">sp</span><span class="p">,</span>
                <span class="n">precision</span><span class="o">=</span><span class="n">stems_precision</span>
            <span class="p">)</span>

        <span class="c1"># Compute overall (TOTAL) metrics.</span>
        <span class="k">if</span> <span class="n">total_counts</span><span class="p">:</span>
            <span class="n">total_mean</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">total_counts</span><span class="p">)</span>
            <span class="n">total_var</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">pvariance</span><span class="p">(</span><span class="n">total_counts</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">total_ba_value</span> <span class="o">=</span> <span class="n">total_mean</span> <span class="o">*</span> <span class="n">ba_factor</span>
            <span class="n">total_ba_precision</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">total_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">ba_factor</span>
            <span class="n">total_stems_value</span> <span class="o">=</span> <span class="n">total_mean</span>
            <span class="n">total_stems_precision</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">total_var</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_ba_value</span> <span class="o">=</span> <span class="n">total_ba_precision</span> <span class="o">=</span> <span class="n">total_stems_value</span> <span class="o">=</span> <span class="n">total_stems_precision</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># You might use a special key for total; here we use the string &quot;TOTAL&quot;.</span>
        <span class="n">basal_area_by_species</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">StandBasalArea</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">total_ba_value</span><span class="p">,</span>
            <span class="n">species</span><span class="o">=</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">,</span>
            <span class="n">precision</span><span class="o">=</span><span class="n">total_ba_precision</span><span class="p">,</span>
            <span class="n">over_bark</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">direct_estimate</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">stems_by_species</span><span class="p">[</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stems</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">total_stems_value</span><span class="p">,</span>
            <span class="n">species</span><span class="o">=</span><span class="s2">&quot;TOTAL&quot;</span><span class="p">,</span>
            <span class="n">precision</span><span class="o">=</span><span class="n">total_stems_precision</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">basal_area_by_species</span><span class="p">,</span> <span class="n">stems_by_species</span></div>
</div>


<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># SiteIndexValue: float with metadata</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SiteIndexValue">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.SiteIndexValue">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SiteIndexValue</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">reference_age</span><span class="p">:</span> <span class="n">AgeMeasurement</span><span class="p">,</span> <span class="c1"># Expects AgeMeasurement</span>
                <span class="n">species</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">TreeName</span><span class="p">],</span> <span class="c1">#Potentially more than one, e.g. Betula pendula, Betula pubescens.</span>
                <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>

        <span class="c1"># Check type of reference_age</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference_age</span><span class="p">,</span> <span class="n">AgeMeasurement</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;reference_age must be an AgeMeasurement object, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">reference_age</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># --- Validate the species set ---</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;species must be a set, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">species</span><span class="p">:</span> <span class="c1"># Check if the set is empty</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;species set cannot be empty.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">TreeName</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All items in the species set must be TreeName objects, found </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Site index value must be non-negative.&quot;</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">reference_age</span> <span class="o">=</span> <span class="n">reference_age</span> <span class="c1"># Store the object</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fn_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
        <span class="c1"># Represent the set of species clearly</span>
        <span class="n">species_repr</span> <span class="o">=</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span> <span class="c1"># Sort for consistent repr</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SiteIndexValue(</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">, reference_age=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_age</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;species=</span><span class="si">{</span><span class="n">species_repr</span><span class="si">}</span><span class="s2">, fn=</span><span class="si">{</span><span class="n">fn_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span> <span class="c1"># Use the set repr</span></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># Volume: float with metadata (units, region, type, etc.)</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Volume">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Volume">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Volume</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores a volume measurement but allows easy conversion and includes region/type constraints.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    region : str</span>
<span class="sd">        The region/country context (e.g. &#39;Sweden&#39;, &#39;Finland&#39;, &#39;Norway&#39;).</span>
<span class="sd">    species : str</span>
<span class="sd">        The species name or code (if known).</span>
<span class="sd">    unit : str</span>
<span class="sd">        The unit in which &#39;value&#39; is expressed (default: &#39;m3&#39;).</span>
<span class="sd">    type : str</span>
<span class="sd">        A string that indicates the volume type/definition (e.g. &#39;m3sk&#39;, &#39;m3to&#39;, etc.).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">UNIT_CONVERSION</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;mm3&#39;</span><span class="p">:</span> <span class="mf">1e-9</span><span class="p">,</span>
        <span class="s1">&#39;cm3&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="s1">&#39;dm3&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
        <span class="s1">&#39;m3&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;dam3&#39;</span><span class="p">:</span> <span class="mf">1e3</span><span class="p">,</span>
        <span class="s1">&#39;hm3&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span>
        <span class="s1">&#39;km3&#39;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">,</span>
        <span class="s1">&#39;Mm3&#39;</span><span class="p">:</span> <span class="mf">1e18</span><span class="p">,</span>
        <span class="s1">&#39;Gm3&#39;</span><span class="p">:</span> <span class="mf">1e27</span><span class="p">,</span>
        <span class="s1">&#39;Tm3&#39;</span><span class="p">:</span> <span class="mf">1e36</span><span class="p">,</span>
        <span class="s1">&#39;Pm3&#39;</span><span class="p">:</span> <span class="mf">1e45</span>
    <span class="p">}</span>
    <span class="n">ORDERED_UNITS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mm3&#39;</span><span class="p">,</span> <span class="s1">&#39;cm3&#39;</span><span class="p">,</span> <span class="s1">&#39;dm3&#39;</span><span class="p">,</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;dam3&#39;</span><span class="p">,</span> <span class="s1">&#39;hm3&#39;</span><span class="p">,</span> <span class="s1">&#39;km3&#39;</span><span class="p">,</span> <span class="s1">&#39;Mm3&#39;</span><span class="p">,</span> <span class="s1">&#39;Gm3&#39;</span><span class="p">,</span> <span class="s1">&#39;Tm3&#39;</span><span class="p">,</span> <span class="s1">&#39;Pm3&#39;</span><span class="p">]</span>

    <span class="n">TYPE_REGIONS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;m3sk&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Sweden&#39;</span><span class="p">,</span> <span class="s1">&#39;Finland&#39;</span><span class="p">,</span> <span class="s1">&#39;Norway&#39;</span><span class="p">],</span>
        <span class="s1">&#39;m3to&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Sweden&#39;</span><span class="p">],</span>
        <span class="s1">&#39;m3fub&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Sweden&#39;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">region</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Sweden&#39;</span><span class="p">,</span>
                <span class="n">species</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span>
                <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;m3sk&#39;</span><span class="p">):</span>
        <span class="c1"># Convert the incoming value to an internal float in cubic meters</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">UNIT_CONVERSION</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit &#39;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&#39; not recognized. Must be one of </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">UNIT_CONVERSION</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">float</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">UNIT_CONVERSION</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="n">region</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_validate_region</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a textual representation, choosing a &quot;nice&quot; unit in the 1–10 range if possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value_m3</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">best_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Attempt a 1-10 range</span>
        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ORDERED_UNITS</span><span class="p">):</span>
            <span class="n">converted_value</span> <span class="o">=</span> <span class="n">value_m3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNIT_CONVERSION</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">converted_value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volume(</span><span class="si">{</span><span class="n">converted_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">, region=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;species=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">&#39;, type=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>
            <span class="c1"># Track the smallest value ≥ 1 to keep as fallback</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">converted_value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">best_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">converted_value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">best_value</span><span class="p">)):</span>
                <span class="n">best_unit</span> <span class="o">=</span> <span class="n">unit</span>
                <span class="n">best_value</span> <span class="o">=</span> <span class="n">converted_value</span>

        <span class="c1"># If no 1-10 match, use the best fallback or extreme</span>
        <span class="k">if</span> <span class="n">best_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volume(</span><span class="si">{</span><span class="n">best_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">best_unit</span><span class="si">}</span><span class="s2">, region=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;species=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">&#39;, type=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>

        <span class="c1"># If we still got nothing, we must be extremely small or zero → use &#39;mm3&#39; or &#39;Pm3&#39;</span>
        <span class="n">extreme_unit</span> <span class="o">=</span> <span class="s1">&#39;mm3&#39;</span> <span class="k">if</span> <span class="n">value_m3</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Pm3&#39;</span>
        <span class="n">extreme_value</span> <span class="o">=</span> <span class="n">value_m3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNIT_CONVERSION</span><span class="p">[</span><span class="n">extreme_unit</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volume(</span><span class="si">{</span><span class="n">extreme_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">extreme_unit</span><span class="si">}</span><span class="s2">, region=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;species=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">&#39;, type=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">allowed_regions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_REGIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># If the volume type is not recognized in TYPE_REGIONS, no restriction is applied</span>
        <span class="k">if</span> <span class="n">allowed_regions</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_regions</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&#39; not allowed for type &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Allowed: </span><span class="si">{</span><span class="n">allowed_regions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Volume.to">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Volume.to">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the internal &#39;m3&#39; float to the specified unit (e.g. &#39;dm3&#39;, &#39;cm3&#39;, etc.)</span>
<span class="sd">        and return the numeric value as a plain float.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNIT_CONVERSION</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unit &#39;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&#39; not recognized.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNIT_CONVERSION</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span></div>


<div class="viewcode-block" id="Volume.m3">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Volume.m3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">m3</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the numeric value in cubic meters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Volume</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="c1"># We consider them &quot;equal&quot; if the numeric volumes match (within float tolerance)</span>
        <span class="c1"># and they are the same &#39;type&#39; (e.g. &#39;m3sk&#39;). Region must also be valid for that type.</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-9</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_REGIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">])</span> <span class="ow">and</span>
            <span class="n">other</span><span class="o">.</span><span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_REGIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">region</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_compatibility</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">),</span>
                      <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                      <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
                      <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span>
                      <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_compatibility</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">),</span>
                      <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                      <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
                      <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span>
                      <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">Volume</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Multiplying Volume by Volume is undefined.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">*</span> <span class="n">scalar</span><span class="p">,</span>
                      <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                      <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
                      <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span>
                      <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">Volume</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Dividing Volume by Volume is undefined.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">/</span> <span class="n">scalar</span><span class="p">,</span>
                      <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                      <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
                      <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span>
                      <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_compatibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Volume</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Both operands must be Volume instances.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incompatible volume types: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_REGIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">])</span> \
           <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">region</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_REGIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">region</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Regions &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&#39; are not both valid for type &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Convenient factory approach for region-based syntax</span>
<div class="viewcode-block" id="Volume.Region">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Volume.Region">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Region</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="n">region</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Permits calls like:</span>
<span class="sd">                Volume.Sweden.m3sk(123, species=&#39;Picea_abies&#39;)</span>
<span class="sd">                Volume.Norway.dm3sk(500, species=&#39;Pinus_sylvestris&#39;)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">creator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">):</span>
                <span class="c1"># We parse out any recognized &#39;unit&#39; prefix from type_unit (like &#39;dm3&#39;)</span>
                <span class="c1"># Then interpret the remainder as a &#39;type&#39; (like &#39;sk&#39;).</span>
                <span class="k">for</span> <span class="n">possible_unit</span> <span class="ow">in</span> <span class="n">Volume</span><span class="o">.</span><span class="n">UNIT_CONVERSION</span><span class="p">:</span>
                    <span class="c1"># Example: &#39;dm3sk&#39; =&gt; possible_unit=&#39;dm3&#39;, remainder=&#39;sk&#39;</span>
                    <span class="k">if</span> <span class="n">type_unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">possible_unit</span><span class="p">):</span>
                        <span class="n">type_suffix</span> <span class="o">=</span> <span class="n">type_unit</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">possible_unit</span><span class="p">):]</span>
                        <span class="c1"># If that remainder is recognized in TYPE_REGIONS:</span>
                        <span class="k">if</span> <span class="n">type_suffix</span> <span class="ow">in</span> <span class="n">Volume</span><span class="o">.</span><span class="n">TYPE_REGIONS</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                          <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                                          <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                                          <span class="n">unit</span><span class="o">=</span><span class="n">possible_unit</span><span class="p">,</span>
                                          <span class="nb">type</span><span class="o">=</span><span class="n">type_suffix</span><span class="p">)</span>
                        <span class="c1"># If remainder is &#39;sk&#39;, interpret as &#39;m3sk&#39;</span>
                        <span class="k">if</span> <span class="n">type_suffix</span> <span class="o">==</span> <span class="s1">&#39;sk&#39;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                          <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                                          <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                                          <span class="n">unit</span><span class="o">=</span><span class="n">possible_unit</span><span class="p">,</span>
                                          <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;m3sk&#39;</span><span class="p">)</span>
                <span class="c1"># Alternatively, if no recognized prefix, treat the entire thing as &#39;type&#39;</span>
                <span class="k">if</span> <span class="n">type_unit</span> <span class="ow">in</span> <span class="n">Volume</span><span class="o">.</span><span class="n">TYPE_REGIONS</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                  <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                                  <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                                  <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span>
                                  <span class="nb">type</span><span class="o">=</span><span class="n">type_unit</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">type_unit</span> <span class="o">==</span> <span class="s1">&#39;sk&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Volume</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                  <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
                                  <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
                                  <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span>
                                  <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;m3sk&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid type/unit combination: &#39;</span><span class="si">{</span><span class="n">type_unit</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">creator</span></div>


    <span class="n">Sweden</span> <span class="o">=</span> <span class="n">Region</span><span class="p">(</span><span class="s1">&#39;Sweden&#39;</span><span class="p">)</span>
    <span class="n">Norway</span> <span class="o">=</span> <span class="n">Region</span><span class="p">(</span><span class="s1">&#39;Norway&#39;</span><span class="p">)</span>
    <span class="n">Finland</span> <span class="o">=</span> <span class="n">Region</span><span class="p">(</span><span class="s1">&#39;Finland&#39;</span><span class="p">)</span></div>



<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># Position: a small data container for location with optional CRS</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Position">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Position">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Position</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents an (X, Y, Z) coordinate with an optional CRS.</span>
<span class="sd">    </span>
<span class="sd">    If crs is None, the coordinate system is assumed to be non‐geographic.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">X</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">Y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">Z</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CRS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="s1">&#39;cartesian&#39;</span>

<div class="viewcode-block" id="Position.from_polar">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Position.from_polar">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_polar</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a Position using polar coordinates.</span>

<span class="sd">        Theta is assumed to be in radians.</span>
<span class="sd">        The resulting Position has no CRS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="s1">&#39;polar&#39;</span>
        <span class="c1"># Optionally store the original polar parameters:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="k">return</span> <span class="n">obj</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Position(X=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="si">}</span><span class="s2">, Y=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="si">}</span><span class="s2">, Z=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="si">}</span><span class="s2">, crs=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_set_position</span><span class="p">(</span><span class="n">pos_in</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Position</span><span class="p">,</span>
                                <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                                <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                                <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Position</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal helper to standardize a user-provided position or tuple</span>
<span class="sd">    into a Position instance, or return None if no valid position is given.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pos_in</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_in</span><span class="p">,</span> <span class="n">Position</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pos_in</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_in</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_in</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">pos_in</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">pos_in</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_in</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">pos_in</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">pos_in</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="o">=</span><span class="n">pos_in</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Position tuple must be length 2 or 3 (x, y, [z]).&quot;</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Position must be a Position or a tuple of floats (x, y, [z]).&quot;</span><span class="p">)</span>


<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># Tree classes</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Tree">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.Tree">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Tree</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all tree objects. You can expand this to include common fields/methods</span>
<span class="sd">    that should exist on any type of tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>



<div class="viewcode-block" id="SingleTree">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.SingleTree">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SingleTree</span><span class="p">(</span><span class="n">Tree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A spatially explicit single tree: (x, y, [z]) in a coordinate system + attributes.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    position : Position | tuple[float,float] | tuple[float,float,float] | None</span>
<span class="sd">        The location of the tree in some coordinate system.</span>
<span class="sd">    species : TreeSpecies | str | None</span>
<span class="sd">        The species of the tree (or a string name to be parsed).</span>
<span class="sd">    age : Age | float | None</span>
<span class="sd">        The age of the tree. If an Age enum is used, it wraps the value in AgeMeasurement.</span>
<span class="sd">    diameter_cm : Diameter_cm | float | None</span>
<span class="sd">        The diameter (cm) if known. If a float is passed, it can be coerced to a Diameter_cm.</span>
<span class="sd">    height_m : float | None</span>
<span class="sd">        The height (m) of the tree if known.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Position</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">TreeSpecies</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">age</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Age</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">diameter_cm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Diameter_cm</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">height_m</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">_set_position</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="c1"># Convert string species → TreeSpecies if parseable</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">parse_tree_species</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>

        <span class="c1"># If `age` is e.g. float or Age, store as is (for more advanced usage,</span>
        <span class="c1"># you might unify to an AgeMeasurement).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

        <span class="c1"># If `diameter_cm` is a float, you could coerce to a default Diameter_cm( ... )</span>
        <span class="c1"># or just store as float. For now, store as given:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diameter_cm</span> <span class="o">=</span> <span class="n">diameter_cm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height_m</span> <span class="o">=</span> <span class="n">height_m</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SingleTree(species=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">, age=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;diameter_cm=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">diameter_cm</span><span class="si">}</span><span class="s2">, height_m=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height_m</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;position=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="RepresentationTree">
<a class="viewcode-back" href="../../../api/Munin.Helpers.html#Munin.Helpers.Primitives.RepresentationTree">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RepresentationTree</span><span class="p">(</span><span class="n">Tree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;multiplicity&quot; tree, i.e. a single record that represents multiple identical trees</span>
<span class="sd">    on a plot (spatially implicit or partially explicit).</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">    position : Position | tuple[float,float] | tuple[float,float,float] | None</span>
<span class="sd">        Location if relevant (often None or the plot center).</span>
<span class="sd">    species : TreeSpecies | str | None</span>
<span class="sd">        Species of the tree(s).</span>
<span class="sd">    age : Age | float | None</span>
<span class="sd">        Age of the tree(s).</span>
<span class="sd">    diameter_cm : Diameter_cm | float | None</span>
<span class="sd">        Diameter of the tree(s).</span>
<span class="sd">    height_m : float | None</span>
<span class="sd">        Height of the tree(s).</span>
<span class="sd">    weight : float</span>
<span class="sd">        Number of stems represented by this single record (e.g. 1, or 5).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Position</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">TreeSpecies</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">age</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Age</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">diameter_cm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Diameter_cm</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">height_m</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">_set_position</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">parse_tree_species</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diameter_cm</span> <span class="o">=</span> <span class="n">diameter_cm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height_m</span> <span class="o">=</span> <span class="n">height_m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RepresentationTree(species=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">, age=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;diameter_cm=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">diameter_cm</span><span class="si">}</span><span class="s2">, height_m=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height_m</span><span class="si">}</span><span class="s2">, weight=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>


</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Munin</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">Munin</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>